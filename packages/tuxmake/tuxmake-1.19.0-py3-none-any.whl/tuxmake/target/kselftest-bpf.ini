[target]
description = "Kernel BPF selftest (kselftest)"
# Some BPF tests use BTF data (type information) from the generated kernel
# image, hence the dependency to kernel and CONFIG_DEBUG_INFO_BTF. The other
# config options are needed to run all BPF tests but not currently included
# by the kselftest-merge target.
dependencies = kernel
kconfig_add = CONFIG_DEBUG_INFO=y
              CONFIG_DEBUG_INFO_REDUCED=n
              CONFIG_DEBUG_INFO_BTF=y
              CONFIG_FTRACE=y
              CONFIG_KPROBES=y
              CONFIG_SYN_COOKIES=y
              CONFIG_TLS=y
              CONFIG_IP_ADVANCED_ROUTER=y
              CONFIG_IP_MULTIPLE_TABLES=y
              CONFIG_NET_L3_MASTER_DEV=y
              CONFIG_NET_VRF=m
              CONFIG_IPV6_SEG6_LWTUNNEL=y
              CONFIG_BPFILTER=y
              CONFIG_NET_ACT_BPF=m
              CONFIG_NF_TABLES=m
              CONFIG_NETFILTER_XT_MATCH_BPF=m
              tools/testing/selftests/bpf/config
commands = {make} -C tools/testing/selftests/ install
    && {tar_caf} {build_dir}/kselftest-bpf.tar{z_ext} -C {build_dir}/kselftest_bpf_install .

[makevars]
INSTALL_PATH = {build_dir}/kselftest_bpf_install
TARGETS = bpf
SKIP_TARGETS =
VMLINUX_BTF = {build_dir}/vmlinux

[artifacts]
kselftest-bpf.tar{z_ext} = kselftest-bpf.tar{z_ext}

