{"version":3,"file":"110.a5719b3429c66bd44236.js?v=a5719b3429c66bd44236","mappings":"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","sources":["webpack://@jupyter-lsp/jupyterlab-lsp/../code-jumpers/src/history.ts","webpack://@jupyter-lsp/jupyterlab-lsp/../code-jumpers/src/jumpers/jumper.ts","webpack://@jupyter-lsp/jupyterlab-lsp/../code-jumpers/src/jumpers/fileeditor.ts","webpack://@jupyter-lsp/jupyterlab-lsp/../code-jumpers/src/jumpers/notebook.ts","webpack://@jupyter-lsp/jupyterlab-lsp/../code-jumpers/src/notebook_private.ts"],"sourcesContent":["import { IGlobalPosition } from './positions';\n\nconst DATABASE: Array<IGlobalPosition> = [];\n\nexport class JumpHistory {\n  store(position: IGlobalPosition) {\n    DATABASE.push(position);\n  }\n\n  // TODO: recollect should take a param with current position;\n  // It shold only go back if current contents_path is the same\n  // as the last one on the stack (or a previous disjoint one).\n  // Probably the jump paths should not be in an array of arrays.\n  recollect(): IGlobalPosition | undefined {\n    return DATABASE.pop();\n  }\n}\n","import { EditorView } from '@codemirror/view';\nimport { Dialog, showDialog } from '@jupyterlab/apputils';\nimport { CodeEditor } from '@jupyterlab/codeeditor';\nimport { IDocumentManager } from '@jupyterlab/docmanager';\nimport { IDocumentWidget } from '@jupyterlab/docregistry';\nimport { FileEditor } from '@jupyterlab/fileeditor';\n\nimport { JumpHistory } from '../history';\nimport { IGlobalPosition, ILocalPosition } from '../positions';\n\nconst movement_keys = [\n  'ArrowRight',\n  'ArrowLeft',\n  'ArrowUp',\n  'ArrowDown',\n  'Home',\n  'End',\n  'PageUp',\n  'PageDown'\n];\n\nconst modifiers = ['Alt', 'AltGraph', 'Control', 'Shift'];\n\nconst system_keys = [\n  'F1',\n  'F2',\n  'F3',\n  'F4',\n  'F5',\n  'F6',\n  'F7',\n  'F8',\n  'F9',\n  'F10',\n  'F11',\n  'F12',\n  'ContextMenu'\n];\n\nexport abstract class CodeJumper {\n  document_manager: IDocumentManager;\n  widget: IDocumentWidget;\n\n  history: JumpHistory;\n\n  abstract get editors(): ReadonlyArray<CodeEditor.IEditor>;\n\n  private go_to_position(\n    document_widget: IDocumentWidget,\n    jumper: string,\n    column: number,\n    line_number: number,\n    input_number = 0\n  ) {\n    let document_jumper: CodeJumper;\n    let position = { line: line_number, column: column };\n    let document_jumper_type = jumpers.get(jumper);\n\n    document_jumper = new document_jumper_type(\n      document_widget,\n      this.document_manager\n    );\n    let jump_position = document_jumper.getJumpPosition(position, input_number);\n    document_jumper.jump(jump_position);\n  }\n\n  private _global_jump(position: IGlobalPosition) {\n    let document_widget = this.document_manager.openOrReveal(\n      position.contents_path\n    );\n    if (!document_widget) {\n      console.log('Widget failed to open for jump');\n      return;\n    }\n    let is_symlink = position.is_symlink;\n\n    document_widget.revealed\n      .then(() => {\n        this.go_to_position(\n          document_widget!,\n          position.contents_path.endsWith('.ipynb') ? 'notebook' : 'fileeditor',\n          position.column,\n          position.line,\n          position.editor_index\n        );\n\n        // protect external files from accidental edition\n        if (is_symlink) {\n          this.protectFromAccidentalEditing(document_widget!);\n        }\n      })\n      .catch(console.warn);\n  }\n\n  private protectFromAccidentalEditing(document_widget: IDocumentWidget) {\n    let editor_widget = document_widget as IDocumentWidget<FileEditor>;\n    // We used to adjust `editor_widget.title.label` here but an upstream\n    // bug (https://github.com/jupyterlab/jupyterlab/issues/10856) prevents\n    // us from doing so anymore.\n    let editor = editor_widget.content.editor;\n    let active = true;\n    editor.injectExtension(\n      EditorView.domEventHandlers({\n        keydown: (event: KeyboardEvent) => {\n          if (!active) {\n            return false;\n          }\n          // allow to move around, select text and use modifiers & browser keys freely\n          if (\n            movement_keys.indexOf(event.key) !== -1 ||\n            modifiers.indexOf(event.key) !== -1 ||\n            system_keys.indexOf(event.key) !== -1\n          ) {\n            return false;\n          }\n\n          // allow to copy text (here assuming that, as on majority of OSs, copy is associated with ctrl+c)\n          // this is not foolproof, but should work in majority of sane settings (unfortunately, not in vim)\n          if (event.key === 'c' && event.ctrlKey) {\n            return false;\n          }\n\n          let dialog_promise = showDialog({\n            title: 'Edit external file?',\n            body:\n              'This file is located outside of the root of the JupyterLab start directory. ' +\n              'do you really wish to edit it?',\n            buttons: [\n              Dialog.cancelButton({ label: 'Cancel' }),\n              Dialog.warnButton({ label: 'Edit anyway' })\n            ]\n          });\n\n          dialog_promise\n            .then(result => {\n              if (result.button.accept) {\n                active = false;\n              }\n            })\n            .catch(console.warn);\n\n          // prevent default\n          return true;\n        }\n      })\n    );\n  }\n\n  protected abstract jump(position: ILocalPosition): void;\n\n  global_jump_back() {\n    let previous_position = this.history.recollect();\n    if (previous_position) {\n      this._global_jump(previous_position);\n    }\n  }\n\n  global_jump(position: IGlobalPosition) {\n    const current_position = this.getCurrentPosition();\n    this.history.store(current_position);\n    this._global_jump(position);\n  }\n\n  abstract getCurrentPosition(): IGlobalPosition;\n\n  abstract getOffset(position: CodeEditor.IPosition, cell?: number): number;\n\n  abstract getJumpPosition(\n    position: CodeEditor.IPosition,\n    input_number?: number\n  ): ILocalPosition;\n}\n\nexport let jumpers: Map<string, any> = new Map();\n","import { CodeEditor } from '@jupyterlab/codeeditor';\nimport { IDocumentManager } from '@jupyterlab/docmanager';\nimport { IDocumentWidget } from '@jupyterlab/docregistry';\nimport { FileEditor } from '@jupyterlab/fileeditor';\n\nimport { JumpHistory } from '../history';\nimport { IGlobalPosition, ILocalPosition } from '../positions';\n\nimport { CodeJumper, jumpers } from './jumper';\n\nexport class FileEditorJumper extends CodeJumper {\n  editor: FileEditor;\n  widget: IDocumentWidget;\n\n  constructor(\n    editor_widget: IDocumentWidget<FileEditor>,\n    document_manager: IDocumentManager\n  ) {\n    super();\n    this.widget = editor_widget;\n    this.document_manager = document_manager;\n    this.editor = editor_widget.content;\n    this.history = new JumpHistory();\n  }\n\n  get path() {\n    return this.widget.context.path;\n  }\n\n  get editors() {\n    return [this.editor.editor];\n  }\n\n  jump(jump_position: ILocalPosition) {\n    let { token } = jump_position;\n\n    // TODO: this is common\n    // place cursor in the line with the definition\n    let position = this.editor.editor.getPositionAt(token.offset)!;\n    this.editor.editor.setSelection({ start: position, end: position });\n    this.editor.editor.focus();\n  }\n\n  getOffset(position: CodeEditor.IPosition) {\n    return this.editor.editor.getOffsetAt(position);\n  }\n\n  getJumpPosition(position: CodeEditor.IPosition): ILocalPosition {\n    return {\n      token: {\n        offset: this.getOffset(position),\n        value: ''\n      },\n      index: 0\n    };\n  }\n\n  getCurrentPosition(): IGlobalPosition {\n    let position = this.editor.editor.getCursorPosition();\n    return {\n      editor_index: 0,\n      line: position.line,\n      column: position.column,\n      contents_path: this.editor.context.path,\n      is_symlink: false\n    };\n  }\n}\n\njumpers.set('fileeditor', FileEditorJumper);\n","import { CodeEditor } from '@jupyterlab/codeeditor';\nimport { IDocumentManager } from '@jupyterlab/docmanager';\nimport { Notebook, NotebookPanel } from '@jupyterlab/notebook';\n\nimport { JumpHistory } from '../history';\nimport { _ensureFocus } from '../notebook_private';\nimport { IGlobalPosition, ILocalPosition } from '../positions';\n\nimport { CodeJumper, jumpers } from './jumper';\n\nexport class NotebookJumper extends CodeJumper {\n  notebook: Notebook;\n  widget: NotebookPanel;\n\n  constructor(\n    notebook_widget: NotebookPanel,\n    document_manager: IDocumentManager\n  ) {\n    super();\n    this.widget = notebook_widget;\n    this.notebook = notebook_widget.content;\n    this.history = new JumpHistory();\n    this.document_manager = document_manager;\n  }\n\n  get editors() {\n    return this.notebook.widgets.map(cell => cell.editor!);\n  }\n\n  jump(position: ILocalPosition) {\n    let { token, index } = position;\n\n    // Prevents event propagation issues\n    setTimeout(() => {\n      this.notebook.deselectAll();\n      this.notebook.activeCellIndex = index!;\n      _ensureFocus(this.notebook);\n      this.notebook.mode = 'edit';\n\n      // find out offset for the element\n      let activeEditor = this.notebook.activeCell!.editor!;\n\n      // place cursor in the line with the definition\n      let position = activeEditor.getPositionAt(token.offset)!;\n      activeEditor.setSelection({ start: position, end: position });\n    }, 0);\n  }\n\n  getOffset(position: CodeEditor.IPosition, cell: number = 0) {\n    return this.editors[cell].getOffsetAt(position);\n  }\n\n  getCurrentPosition(): IGlobalPosition {\n    let position =\n      this.editors[this.notebook.activeCellIndex].getCursorPosition();\n\n    return {\n      editor_index: this.notebook.activeCellIndex,\n      line: position.line,\n      column: position.column,\n      contents_path: this.widget.context.path,\n      is_symlink: false\n    };\n  }\n\n  getJumpPosition(position: CodeEditor.IPosition, input_number: number) {\n    return {\n      token: {\n        offset: this.getOffset(position, input_number),\n        value: ''\n      },\n      index: input_number\n    };\n  }\n}\n\njumpers.set('notebook', NotebookJumper);\n","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n\nimport { Notebook } from '@jupyterlab/notebook';\n\n/**\n * Ensure that the notebook has proper focus.\n */\nfunction _ensureFocus(notebook: Notebook, force = false): void {\n  let activeCell = notebook.activeCell;\n  if (notebook.mode === 'edit' && activeCell && activeCell.editor) {\n    if (!activeCell.editor.hasFocus()) {\n      activeCell.editor.focus();\n    }\n  }\n  if (force && !notebook.node.contains(document.activeElement)) {\n    notebook.node.focus();\n  }\n}\n\nexport { _ensureFocus };\n"],"names":["DATABASE","JumpHistory","store","position","push","recollect","pop","movement_keys","modifiers","system_keys","CodeJumper","go_to_position","document_widget","jumper","column","line_number","input_number","document_jumper","line","jumpers","get","this","document_manager","jump_position","getJumpPosition","jump","_global_jump","openOrReveal","contents_path","console","log","is_symlink","revealed","then","endsWith","editor_index","protectFromAccidentalEditing","catch","warn","editor","content","active","injectExtension","EditorView","domEventHandlers","keydown","event","indexOf","key","ctrlKey","showDialog","title","body","buttons","Dialog","cancelButton","label","warnButton","result","button","accept","global_jump_back","previous_position","history","global_jump","current_position","getCurrentPosition","Map","FileEditorJumper","constructor","editor_widget","super","widget","path","context","editors","token","getPositionAt","offset","setSelection","start","end","focus","getOffset","getOffsetAt","value","index","getCursorPosition","set","NotebookJumper","notebook_widget","notebook","widgets","map","cell","setTimeout","deselectAll","activeCellIndex","force","activeCell","mode","hasFocus","node","contains","document","activeElement","_ensureFocus","activeEditor"],"sourceRoot":""}