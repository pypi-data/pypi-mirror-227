local hkdf_tests = {
    {
        ikm='0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b',
        salt='000102030405060708090a0b0c',
        info='f0f1f2f3f4f5f6f7f8f9',
        l=42,

        prk='077709362c2e32df0ddc3f0dc47bba6390b6c73bb50f9c3122ec844ad7c2b3e5',
        okm='3cb25f25faacd57a90434f64d0362f2a2d2d0a90cf1a5a4c5db02d56ecc4c5bf34007208d5b887185865'
    },
    {
        ikm='000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f404142434445464748494a4b4c4d4e4f',
        salt='606162636465666768696a6b6c6d6e6f707172737475767778797a7b7c7d7e7f808182838485868788898a8b8c8d8e8f909192939495969798999a9b9c9d9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeaf',
        info='b0b1b2b3b4b5b6b7b8b9babbbcbdbebfc0c1c2c3c4c5c6c7c8c9cacbcccdcecfd0d1d2d3d4d5d6d7d8d9dadbdcdddedfe0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff',
        l=82,

        prk='06a6b88c5853361a06104c9ceb35b45cef760014904671014a193f40c15fc244',
        okm='b11e398dc80327a1c8e7f78c596a49344f012eda2d4efad8a050cc4c19afa97c59045a99cac7827271cb41c65e590e09da3275600c2f09b8367793a9aca3db71cc30c58179ec3e87c14c01d5c1f3434f1d87'
    },
    {
        ikm='0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b',
        salt=O.empty(),
        info=O.empty(),
        l=42,

        prk='19ef24a32c717b167f33a91d6f648bdf96596776afdb6377ac434c1c293ccb04',
        okm='8da4e775a563c18f715f802a063c5a31b8a11f5c5ee1879ec3454e5f3c738d2d9d201395faa4b61a96c8'
    },
}

local function run_test_hkdf(test)
    if type(test.salt) == 'string' then
        test.salt = O.from_hex(test.salt)
    end
    if type(test.info) == 'string' then
        test.info = O.from_hex(test.info)
    end
    local prk = hkdf_extract(test.salt, O.from_hex(test.ikm))
    assert(O.from_hex(test.prk) == prk)
    local okm = hkdf_expand(prk, test.info, test.l)
    assert(O.from_hex(test.okm) == okm)
end

print('----------------------')
print("TEST: hkdf (extract + expand)")
for k,v in pairs(hkdf_tests) do
    print("Test Case " .. k)
    run_test_hkdf(v)
end



print('----------------------')
print("TEST: expand_message_xmd (SHA-256)")

-- expand_message_xmd(SHA-256)
local DST_test = 'QUUX-V01-CS02-with-expander-SHA256-128'

-- Test vectors originated from:
-- draft-irtf-cfrg-hash-to-curve, Appendix K.1
local expand_message_xmd_SHA_256_test = {
    {
      msg     = '',
      len_in_bytes = '0x20',
      DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826', 
      msg_prime = '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
      uniform_bytes = '68a985b87eb6b46952128911f2a4412bbc302a9d759667f87f7a21d803f07235'
    },
    {
        msg  = 'abc',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000616263002000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = 'd8ccab23b5985ccea865c6c97b6e5b8350e794e603b4b97902f53a8a0d605615',
    },
    {    
        msg  = 'abcdef0123456789',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000061626364656630313233343536373839002000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = 'eff31487c770a893cfb36f912fbfcbff40d5661771ca4b2cb4eafe524333f5c1'
    },
    {
        msg  = 'q128_qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000713132385f7171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171002000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = 'b23a1d2b4d97b2ef7785562a7e8bac7eed54ed6e97e29aa51bfe3f12ddad1ff9'
    },
    {
        msg  = 'a512_aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000613531325f6161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161002000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = '4623227bcc01293b8c130bf771da8c298dede7383243dc0993d2d94823958c4c'
    },
    {
        msg  = '',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = 'af84c27ccfd45d41914fdff5df25293e221afc53d8ad2ac06d5e3e29485dadbee0d121587713a3e0dd4d5e69e93eb7cd4f5df4cd103e188cf60cb02edc3edf18eda8576c412b18ffb658e3dd6ec849469b979d444cf7b26911a08e63cf31f9dcc541708d3491184472c2c29bb749d4286b004ceb5ee6b9a7fa5b646c993f0ced'
    },
    {
        msg     = 'abc',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000616263008000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = 'abba86a6129e366fc877aab32fc4ffc70120d8996c88aee2fe4b32d6c7b6437a647e6c3163d40b76a73cf6a5674ef1d890f95b664ee0afa5359a5c4e07985635bbecbac65d747d3d2da7ec2b8221b17b0ca9dc8a1ac1c07ea6a1e60583e2cb00058e77b7b72a298425cd1b941ad4ec65e8afc50303a22c0f99b0509b4c895f40'
    },
    {
        msg     = 'abcdef0123456789',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000061626364656630313233343536373839008000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = 'ef904a29bffc4cf9ee82832451c946ac3c8f8058ae97d8d629831a74c6572bd9ebd0df635cd1f208e2038e760c4994984ce73f0d55ea9f22af83ba4734569d4bc95e18350f740c07eef653cbb9f87910d833751825f0ebefa1abe5420bb52be14cf489b37fe1a72f7de2d10be453b2c9d9eb20c7e3f6edc5a60629178d9478df'
    },
    {
        msg  = 'q128_qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000713132385f7171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171008000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = '80be107d0884f0d881bb460322f0443d38bd222db8bd0b0a5312a6fedb49c1bbd88fd75d8b9a09486c60123dfa1d73c1cc3169761b17476d3c6b7cbbd727acd0e2c942f4dd96ae3da5de368d26b32286e32de7e5a8cb2949f866a0b80c58116b29fa7fabb3ea7d520ee603e0c25bcaf0b9a5e92ec6a1fe4e0391d1cdbce8c68a'

    },
    {
        msg     = 'a512_aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        msg_prime = '00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000613531325f6161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161008000515555582d5630312d435330322d776974682d657870616e6465722d5348413235362d31323826',
        uniform_bytes = '546aff5444b5b79aa6148bd81728704c32decb73a3ba76e9e75885cad9def1d06d6792f8a7d12794e90efed817d96920d728896a4510864370c207f99bd4a608ea121700ef01ed879745ee3e4ceef777eda6d9e5e38b90c86ea6fb0b36504ba4a45d22e86f6db5dd43d98a294bebb9125d5b794e9d2a81181066eb954966a487'
    }

}

local function run_test_expand_message_xmd_SHA_256 (test)
    local output_bytes, output_DST, output_msg = expand_message_xmd(O.from_string(test.msg), O.from_string(DST_test), tonumber(test.len_in_bytes))
    assert(output_bytes:hex() == test.uniform_bytes, "Wrong output bytes")
    assert(output_DST:hex() == test.DST_prime, "Wrong dst prime")
    assert(output_msg:hex() == test.msg_prime, "Wrong msg_prime")
end

for k,v in pairs(expand_message_xmd_SHA_256_test) do
    print("Test Case " .. k)
    run_test_expand_message_xmd_SHA_256(v)
end


print('----------------------------')
print("TEST: expand_message_xof (SHAKE256)")

--Test vectors originate from:
-- draft-irtf-cfrg-hash-to-curve-16 Appendix K.6
local DST_EXPAND_MSG_XOF = 'QUUX-V01-CS02-with-expander-SHAKE256'
local EXP_MSG_XOF_k = 256

local expand_message_xof_test = {

    {   msg = '',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '0020515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = '2ffc05c48ed32b95d72e807f6eab9f7530dd1c2f013914c8fed38c5ccc15ad76'
    },
    
    {   msg = 'abc',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '6162630020515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = 'b39e493867e2767216792abce1f2676c197c0692aed061560ead251821808e07'
    },

    {   msg = 'abcdef0123456789',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '616263646566303132333435363738390020515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = '245389cf44a13f0e70af8665fe5337ec2dcd138890bb7901c4ad9cfceb054b65'
    },

    {   msg = 'q128_qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '713132385f71717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171710020515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = '719b3911821e6428a5ed9b8e600f2866bcf23c8f0515e52d6c6c019a03f16f0e'
    },

    {   msg = 'a512_aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa',
        len_in_bytes = '0x20',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '613531325f61616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161610020515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = '9181ead5220b1963f1b5951f35547a5ea86a820562287d6ca4723633d17ccbbc'
    },

    {   msg  = '',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '0080515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = '7a1361d2d7d82d79e035b8880c5a3c86c5afa719478c007d96e6c88737a3f631dd74a2c88df79a4cb5e5d9f7504957c70d669ec6bfedc31e01e2bacc4ff3fdf9b6a00b17cc18d9d72ace7d6b81c2e481b4f73f34f9a7505dccbe8f5485f3d20c5409b0310093d5d6492dea4e18aa6979c23c8ea5de01582e9689612afbb353df'
    },

    {   msg = 'abc',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '6162630080515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = 'a54303e6b172909783353ab05ef08dd435a558c3197db0c132134649708e0b9b4e34fb99b92a9e9e28fc1f1d8860d85897a8e021e6382f3eea10577f968ff6df6c45fe624ce65ca25932f679a42a404bc3681efe03fcd45ef73bb3a8f79ba784f80f55ea8a3c367408f30381299617f50c8cf8fbb21d0f1e1d70b0131a7b6fbe'
    },

    {   msg = 'abcdef0123456789',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '616263646566303132333435363738390080515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = 'e42e4d9538a189316e3154b821c1bafb390f78b2f010ea404e6ac063deb8c0852fcd412e098e231e43427bd2be1330bb47b4039ad57b30ae1fc94e34993b162ff4d695e42d59d9777ea18d3848d9d336c25d2acb93adcad009bcfb9cde12286df267ada283063de0bb1505565b2eb6c90e31c48798ecdc71a71756a9110ff373'
    },

    {   msg = 'q128_qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '713132385f71717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171710080515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = '4ac054dda0a38a65d0ecf7afd3c2812300027c8789655e47aecf1ecc1a2426b17444c7482c99e5907afd9c25b991990490bb9c686f43e79b4471a23a703d4b02f23c669737a886a7ec28bddb92c3a98de63ebf878aa363a501a60055c048bea11840c4717beae7eee28c3cfa42857b3d130188571943a7bd747de831bd6444e0'
    },

    {   msg = 'a512_aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa',
        len_in_bytes = '0x80',
        DST_prime = '515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        msg_prime = '613531325f61616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161616161610080515555582d5630312d435330322d776974682d657870616e6465722d5348414b4532353624',
        uniform_bytes = '09afc76d51c2cccbc129c2315df66c2be7295a231203b8ab2dd7f95c2772c68e500bc72e20c602abc9964663b7a03a389be128c56971ce81001a0b875e7fd17822db9d69792ddf6a23a151bf470079c518279aef3e75611f8f828994a9988f4a8a256ddb8bae161e658d5a2a09bcfe839c6396dc06ee5c8ff3c22d3b1f9deb7e'
    }
}


local function run_test_expand_message_xof_SHAKE_128 (test)
    local output_bytes_xof, output_DST_xof, output_msg_xof = expand_message_xof(O.from_string(test.msg), O.from_string(DST_EXPAND_MSG_XOF), tonumber(test.len_in_bytes))
    assert(output_DST_xof:hex() == test.DST_prime, "Wrong dst prime")
    assert(output_msg_xof:hex() == test.msg_prime, "Wrong msg_prime")
    assert(output_bytes_xof:hex() == test.uniform_bytes, "Wrong output bytes")
    
end

for k,v in pairs(expand_message_xof_test) do
    print("Test Case " .. k)
    run_test_expand_message_xof_SHAKE_128(v)
end
