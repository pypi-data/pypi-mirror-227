<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>IntelMQ API &#8212; intelmq 3.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IntelMQ Manager" href="intelmq-manager.html" />
    <link rel="prev" title="Data Feeds" href="feeds.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="intelmq-api">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">IntelMQ API</a><a class="headerlink" href="#intelmq-api" title="Permalink to this heading">¶</a></h1>
<p><cite>intelmq-api</cite> is a <a class="reference external" href="https://fastapi.tiangolo.com/">FastAPI</a> based API for the <a class="reference external" href="https://github.com/certtools/intelmq/">IntelMQ</a> project.</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#intelmq-api" id="id1">IntelMQ API</a></p>
<ul>
<li><p><a class="reference internal" href="#installing-and-running-intelmq-api" id="id2">Installing and running intelmq-api</a></p>
<ul>
<li><p><a class="reference internal" href="#installation-using-pip" id="id3">Installation using pip</a></p>
<ul>
<li><p><a class="reference internal" href="#installing-packages" id="id4">Installing packages</a></p></li>
<li><p><a class="reference internal" href="#configuring-apache" id="id5">Configuring Apache</a></p></li>
<li><p><a class="reference internal" href="#configuring-systemd-services" id="id6">Configuring Systemd services</a></p></li>
<li><p><a class="reference internal" href="#setup-api-configuration-files" id="id7">Setup API configuration files</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id8">Next steps</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-intelmq-api" id="id9">Configuring intelmq-api</a></p>
<ul>
<li><p><a class="reference internal" href="#permissions" id="id10">Permissions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-a-user" id="id11">Adding a user</a></p></li>
<li><p><a class="reference internal" href="#a-note-on-selinux" id="id12">A note on SELinux</a></p></li>
<li><p><a class="reference internal" href="#usage-from-programs" id="id13">Usage from programs</a></p></li>
<li><p><a class="reference internal" href="#frequent-operational-problems" id="id14">Frequent operational problems</a></p>
<ul>
<li><p><a class="reference internal" href="#intelmqctlerror" id="id15">IntelMQCtlError</a></p></li>
<li><p><a class="reference internal" href="#access-denied-authentication-required-please-provide-valid-token-verification-credentials" id="id16">Access Denied / Authentication Required “Please provide valid Token verification credentials”</a></p></li>
<li><p><a class="reference internal" href="#internal-server-error" id="id17">Internal Server Error</a></p></li>
<li><p><a class="reference internal" href="#can-i-just-install-it-from-the-deb-rpm-packages-while-installing-intelmq-from-a-different-source" id="id18">Can I just install it from the deb/rpm packages while installing IntelMQ from a different source?</a></p></li>
<li><p><a class="reference internal" href="#sqlite3-operationalerror-attempt-to-write-a-readonly-database" id="id19">sqlite3.OperationalError: attempt to write a readonly database</a></p></li>
<li><p><a class="reference internal" href="#sqlite3-operationalerror-unable-to-open-database-file" id="id20">sqlite3.OperationalError: unable to open database file</a></p></li>
<li><p><a class="reference internal" href="#gunicorn-returns-modulenotfounderror-no-module-named-uvicorn-but-uvicorn-is-installed" id="id21">Gunicorn returns <code class="docutils literal notranslate"><span class="pre">ModuleNotFoundError:</span> <span class="pre">No</span> <span class="pre">module</span> <span class="pre">named</span> <span class="pre">'uvicorn'</span></code>, but Uvicorn is installed</a></p></li>
<li><p><a class="reference internal" href="#can-i-use-other-web-servers-or-proxy" id="id22">Can I use other web servers or proxy?</a></p></li>
<li><p><a class="reference internal" href="#how-to-debug-api-running-as-system-service" id="id23">How to debug API running as system service?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#getting-help" id="id24">Getting help</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="installing-and-running-intelmq-api">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Installing and running intelmq-api</a><a class="headerlink" href="#installing-and-running-intelmq-api" title="Permalink to this heading">¶</a></h2>
<p><cite>intelmq-api</cite> requires the IntelMQ package to be installed on the system (it uses <code class="docutils literal notranslate"><span class="pre">intelmqctl</span></code> to control the botnet).</p>
<p>You can install the <code class="docutils literal notranslate"><span class="pre">intelmq-api</span></code> package using your preferred system package installation mechanism or using the <code class="docutils literal notranslate"><span class="pre">pip</span></code> Python package installer.
We provide packages for the <cite>intelmq-api</cite> for the same operating systems as we do for the <cite>intelmq</cite> package itself.
For the list of supported distributions, please see the intelmq <a class="reference internal" href="installation.html"><span class="doc">Installation</span></a> page.</p>
<p>Our repository page gives <a class="reference external" href="https://software.opensuse.org/download.html?project=home:sebix:intelmq&amp;package=intelmq-api">installation instructions for various operating systems</a>.
No additional set-up steps are needed if you use these packages.</p>
<p>The <cite>intelmq-api</cite> provides the route <code class="docutils literal notranslate"><span class="pre">/v1/api</span></code> for managing the IntelMQ installation.</p>
<p>For development purposes and testing, you can also run <cite>intelmq-api</cite> using development script
from this <a class="reference external" href="https://github.com/certtools/intelmq-api">repository</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/run_dev.sh
</pre></div>
</div>
<p>The API is then served on <code class="docutils literal notranslate"><span class="pre">127.0.0.1:8000/v1/api</span></code>, and the interactive documentation on <code class="docutils literal notranslate"><span class="pre">127.0.0.1:8000/docs</span></code>.
Please refer to the repository README for more development tips.</p>
<section id="installation-using-pip">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Installation using pip</a><a class="headerlink" href="#installation-using-pip" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Native system packages (DEB, RPM) should automatically prepare steps described in this section. If
you wish to base on package from pip, you may need to do them manually, as described below.</p>
</div>
<p>To configure your system to serve the API for not-development purposes, you need to prepare a
configuration for IntelMQ API, a position config for the IntelMQ Manager as well as a web application
server and a (reverse)proxy. For all those steps we have prepared example configuration, intended
to work with <a class="reference external" href="https://gunicorn.org/">Gunicorn</a> as the web server and <a class="reference external" href="https://httpd.apache.org/">Apache 2</a>
as the proxy.</p>
<dl class="simple">
<dt>The <cite>intelmq-api</cite> package ships the following example files:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/api-config.json</span></code> - the API configuration,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/manager/positions.conf</span></code> - positions configuration for the manager,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/api-apache.conf</span></code> - a virtualhost configuration file for Apache 2,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/api-sudoers.conf</span></code> - a sudoers configuration file,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/intelmq-api.service</span></code> - a systemd service unit configuration for Gunicorn,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/intelmq-api.socket</span></code> - a systemd socket unit configuration.</p></li>
</ul>
</dd>
</dl>
<p>The value of <code class="docutils literal notranslate"><span class="pre">${PREFIX}</span></code> depends on your environment and is something like <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/pythonX.Y/dist-packages/</span></code> (where <code class="docutils literal notranslate"><span class="pre">X.Y</span></code> is your Python version).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All configuration files have example paths to the IntelMQ API package. During the installation
please ensure to update them with the right value, as the <code class="docutils literal notranslate"><span class="pre">${PREFIX}</span></code>.</p>
</div>
<section id="installing-packages">
<h4><a class="toc-backref" href="#id4" role="doc-backlink">Installing packages</a><a class="headerlink" href="#installing-packages" title="Permalink to this heading">¶</a></h4>
<p>Let’s start with installing the IntelMQ API package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>intelmq-api
</pre></div>
</div>
<p>You need to install Gunicorn and Apache2 on your own, e.g., using apt:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>apt<span class="w"> </span>install<span class="w"> </span>gunicorn<span class="w"> </span>apache2
</pre></div>
</div>
<p>Then, if you didn’t use it before, ensure to enable the <code class="docutils literal notranslate"><span class="pre">proxy_http</span></code> module for Apache:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>a2enmod<span class="w"> </span>proxy_http
</pre></div>
</div>
</section>
<section id="configuring-apache">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Configuring Apache</a><a class="headerlink" href="#configuring-apache" title="Permalink to this heading">¶</a></h4>
<dl class="simple">
<dt>The file <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/api-apache.conf</span></code> needs to be placed in the correct place for your Apache 2 installation.</dt><dd><ul class="simple">
<li><p>On Debian and Ubuntu, move the file to <code class="docutils literal notranslate"><span class="pre">/etc/apache2/conf-available.d/api-apache.conf</span></code> and then execute <code class="docutils literal notranslate"><span class="pre">a2enconf</span> <span class="pre">api-apache</span></code>.</p></li>
<li><p>On CentOS, RHEL and Fedora, move the file to <code class="docutils literal notranslate"><span class="pre">/etc/httpd/conf.d/</span></code>.</p></li>
<li><p>On openSUSE, move the file to <code class="docutils literal notranslate"><span class="pre">/etc/apache2/conf.d/</span></code>.</p></li>
</ul>
</dd>
</dl>
<p>Don’t forget to reload the Apache2 afterwards.</p>
</section>
<section id="configuring-systemd-services">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Configuring Systemd services</a><a class="headerlink" href="#configuring-systemd-services" title="Permalink to this heading">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step could be also done by calling the script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>intelmq-api-setup-systemd
</pre></div>
</div>
</div>
<p>The systemd configuration files (<code class="docutils literal notranslate"><span class="pre">intelmq-api.service</span></code> and <code class="docutils literal notranslate"><span class="pre">intelmq-api.socket</span></code>) are responsible
for instructing systemd daemon to start and keep running Gunicorn (that serves the API), and
forwarding requests between proxy and the Gunicorn instance.</p>
<ul class="simple">
<li><p>Files <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/intelmq-api.service</span></code> and <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/intelmq-api.socket</span></code>
should be placed in <code class="docutils literal notranslate"><span class="pre">/lib/systemd/system/</span></code> directory. Then adapt the webserver username in
<code class="docutils literal notranslate"><span class="pre">intelmq-api.service</span></code>.</p></li>
</ul>
<p>After moving files, you can enable the service by executing <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">intelmq-api</span></code> to
start it on the system startup.</p>
</section>
<section id="setup-api-configuration-files">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Setup API configuration files</a><a class="headerlink" href="#setup-api-configuration-files" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>The file <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/api-config.json</span></code> needs to be moved to <code class="docutils literal notranslate"><span class="pre">/etc/intelmq/api-config.json</span></code>.</p></li>
<li><p>The file <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/manager/positions.conf</span></code> needs to be moved to <code class="docutils literal notranslate"><span class="pre">/etc/intelmq/manager/positions.conf</span></code>.</p></li>
<li><p>Last but not least move the file <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/api-sudoers.conf</span></code> to <code class="docutils literal notranslate"><span class="pre">/etc/sudoers.d/01_intelmq-api</span></code> and adapt the webserver username in this file. Set the file permissions to <code class="docutils literal notranslate"><span class="pre">0o440</span></code>.</p></li>
</ul>
<p>Afterwards, continue with the section Permissions below. When you finish the configuration,
you can start the service using <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">intelmq-api</span></code>. You may need to restart the service
after any configuration change.</p>
</section>
<section id="next-steps">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Next steps</a><a class="headerlink" href="#next-steps" title="Permalink to this heading">¶</a></h4>
<p>The example Apache2 and Gunicorn configurations serve the IntelMQ API under <code class="docutils literal notranslate"><span class="pre">/intelmq</span></code> prefix,
what means that at this moment you should be able to get, e.g., the API documentation under
<code class="docutils literal notranslate"><span class="pre">/intelmq/docs</span></code> etc.</p>
<p>Now, you should continue with the API configuration and creating users. If you didn’t do it before,
it’s also time to configure IntelMQ itself.</p>
<p>IntelMQ 2.3.1 comes with a tool <code class="docutils literal notranslate"><span class="pre">intelmqsetup</span></code> which helps with performing some steps automatically.
Please note that the tool is still under development and may not detect all situations correctly.
Please report us any bugs you are observing. The tool is idempotent, you can execute it multiple times.</p>
</section>
</section>
</section>
<section id="configuring-intelmq-api">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Configuring intelmq-api</a><a class="headerlink" href="#configuring-intelmq-api" title="Permalink to this heading">¶</a></h2>
<p>Depending on your setup, you might have to install <code class="docutils literal notranslate"><span class="pre">sudo</span></code> to make it possible for the <code class="docutils literal notranslate"><span class="pre">intelmq-api</span></code> to run the <code class="docutils literal notranslate"><span class="pre">intelmq</span></code> command as the user-account usually used to run <code class="docutils literal notranslate"><span class="pre">intelmq</span></code> (which is also often called <code class="docutils literal notranslate"><span class="pre">intelmq</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">intelmq-api</span></code> is configured using a configuration file in <code class="docutils literal notranslate"><span class="pre">json</span></code> format.
<code class="docutils literal notranslate"><span class="pre">intelmq-api</span></code> tries to load the configuration file from <code class="docutils literal notranslate"><span class="pre">/etc/intelmq/api-config.json</span></code> and <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/api-config.json</span></code>, but you can override the path setting the environment variable <code class="docutils literal notranslate"><span class="pre">INTELMQ_API_CONFIG</span></code>.
(When using Gunicorn and systemd service, you can do this by modifying the <code class="docutils literal notranslate"><span class="pre">intelmq-api.service</span></code> configuration file shipped with <code class="docutils literal notranslate"><span class="pre">intelmq-api</span></code>, the file contains an example)</p>
<p>When running the API using development mode, you can set the environment variable like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">INTELMQ_API_CONFIG</span><span class="o">=</span>/etc/intelmq/api-config.json<span class="w"> </span>./scripts/run_dev.sh
</pre></div>
</div>
<p>The default configuration which is shipped with the packages is also listed here for reference:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;intelmq_ctl_cmd&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;sudo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;intelmq&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;intelmqctl&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;allowed_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/opt/intelmq/var/lib/bots/&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;session_store&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/etc/intelmq/api-session.sqlite&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;session_duration&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">86400</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;allow_origins&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>On Debian based systems, the default path for the <code class="docutils literal notranslate"><span class="pre">session_store</span></code> is <code class="docutils literal notranslate"><span class="pre">/var/lib/dbconfig-common/sqlite3/intelmq-api/intelmqapi</span></code> because the Debian package uses the Debian packaging tools to manage the database file.</p>
<p>The following configuration options are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intelmq_ctl_cmd</span></code>: Your <code class="docutils literal notranslate"><span class="pre">intelmqctl</span></code> command. If this is not set in a configuration file the default is used, which is <code class="docutils literal notranslate"><span class="pre">[&quot;sudo&quot;,</span> <span class="pre">&quot;-u&quot;,</span> <span class="pre">&quot;intelmq&quot;,</span> <span class="pre">&quot;/usr/local/bin/intelmqctl&quot;]</span></code>
The option <code class="docutils literal notranslate"><span class="pre">&quot;intelmq_ctl_cmd&quot;</span></code> is a list of strings so that we can avoid shell-injection vulnerabilities because no shell is involved when running the command.
This means that if the command you want to use needs parameters, they have to be separate strings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allowed_path</span></code>: intelmq-api can grant <strong>read-only</strong> access to specific files - this setting defines the path those files can reside in.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">session_store</span></code>: this is an optional path to a sqlite database, which is used for session storage and authentication. If it is not set (which is the default), no authentication is used!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">session_duration</span></code>: the maximal duration of a session, it’s 86400 seconds by default</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allow_origins</span></code>: a list of origins the responses of the API can be shared with. Allows every origin by default.</p></li>
</ul>
<section id="permissions">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Permissions</a><a class="headerlink" href="#permissions" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">intelmq-api</span></code> tries to write a couple of configuration files in the <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq</span></code> directory - this is only possible if you set the permissions accordingly, given that <code class="docutils literal notranslate"><span class="pre">intelmq-api</span></code> runs under a different user.
The user the API run as also needs write access to the folder the <code class="docutils literal notranslate"><span class="pre">session_store</span></code> is located in; otherwise there will be an error accessing the session data.
If you’re using the default Apache 2 setup, you might want to set the group of the files to <code class="docutils literal notranslate"><span class="pre">www-data</span></code> and give it write permissions (<code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">-R</span> <span class="pre">g+w</span> <span class="pre">&lt;directoryname&gt;</span></code>).
In addition to that, the <code class="docutils literal notranslate"><span class="pre">intelmq-manager</span></code> tries to store the bot positions via the API into the file <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/manager/positions.conf</span></code>.
You should therefore create the folder <code class="docutils literal notranslate"><span class="pre">${PREFIX}/etc/intelmq/manager</span></code> and the file <code class="docutils literal notranslate"><span class="pre">positions.conf</span></code> in it.</p>
</section>
</section>
<section id="adding-a-user">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Adding a user</a><a class="headerlink" href="#adding-a-user" title="Permalink to this heading">¶</a></h2>
<p>If you enable the <code class="docutils literal notranslate"><span class="pre">session_store</span></code> you will have to create user accounts to be able to access the API functionality. You can do this using <code class="docutils literal notranslate"><span class="pre">intelmq-api-adduser</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>intelmq-api-adduser<span class="w"> </span>--user<span class="w"> </span>&lt;username&gt;<span class="w"> </span>--password<span class="w"> </span>&lt;password&gt;
</pre></div>
</div>
</section>
<section id="a-note-on-selinux">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">A note on SELinux</a><a class="headerlink" href="#a-note-on-selinux" title="Permalink to this heading">¶</a></h2>
<p>On systems with SELinux enabled, the API will fail to call intelmqctl.
Therefore, SELinux needs to be disabled:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>setenforce<span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
<p>We welcome contributions to provide SELinux policies.</p>
</section>
<section id="usage-from-programs">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Usage from programs</a><a class="headerlink" href="#usage-from-programs" title="Permalink to this heading">¶</a></h2>
<p>The IntelMQ API can also be used from programs, not just browsers.
To do so, first send a POST-Request with JSON-formatted data to <a class="reference external" href="http://localhost/intelmq/v1/api/login/">http://localhost/intelmq/v1/api/login/</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$your_username&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$your_password&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With valid credentials, the JSON-formatted response contains the <code class="docutils literal notranslate"><span class="pre">login_token</span></code>.
This token can be used like an API key in the Authorization header for the next API calls:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Authorization:<span class="w"> </span><span class="nv">$login_token</span>
</pre></div>
</div>
<p>Here is a full example using <em>curl</em>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>curl<span class="w"> </span>--location<span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://localhost/intelmq/v1/api/login/&quot;</span><span class="se">\</span>
<span class="w">    </span>--header<span class="w"> </span><span class="s2">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span><span class="se">\</span>
<span class="w">    </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;username=</span><span class="nv">$username</span><span class="s2">&quot;</span><span class="se">\</span>
<span class="w">    </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;password=</span><span class="nv">$password</span><span class="s2">&quot;</span>
<span class="o">{</span><span class="s2">&quot;login_token&quot;</span>:<span class="s2">&quot;68b329da9893e34099c7d8ad5cb9c940&quot;</span>,<span class="s2">&quot;username&quot;</span>:<span class="s2">&quot;</span><span class="nv">$username</span><span class="s2">&quot;</span><span class="o">}</span>
&gt;<span class="w"> </span>curl<span class="w"> </span>--location<span class="w"> </span><span class="s2">&quot;http://localhost/intelmq/v1/api/version&quot;</span><span class="se">\</span>
<span class="w">    </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: 68b329da9893e34099c7d8ad5cb9c940&quot;</span>
<span class="o">{</span><span class="s2">&quot;intelmq&quot;</span>:<span class="s2">&quot;3.0.0rc1&quot;</span>,<span class="s2">&quot;intelmq-manager&quot;</span>:<span class="s2">&quot;2.3.1&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>The same approach also works for <em>Ansible</em>, as you can see here:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://github.com/schacht-certat/intelmq-vagrant/blob/7082719609c0aafc9324942a8775cf2f8813703d/ansible/tasks/api/00_registerauth.yml#L1-L9">https://github.com/schacht-certat/intelmq-vagrant/blob/7082719609c0aafc9324942a8775cf2f8813703d/ansible/tasks/api/00_registerauth.yml#L1-L9</a></p></li>
<li><p><a class="reference external" href="https://github.com/schacht-certat/intelmq-vagrant/blob/7082719609c0aafc9324942a8775cf2f8813703d/ansible/tasks/api/02_queuestatus.yml#L1-L5">https://github.com/schacht-certat/intelmq-vagrant/blob/7082719609c0aafc9324942a8775cf2f8813703d/ansible/tasks/api/02_queuestatus.yml#L1-L5</a></p></li>
</ol>
</section>
<section id="frequent-operational-problems">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Frequent operational problems</a><a class="headerlink" href="#frequent-operational-problems" title="Permalink to this heading">¶</a></h2>
<section id="intelmqctlerror">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">IntelMQCtlError</a><a class="headerlink" href="#intelmqctlerror" title="Permalink to this heading">¶</a></h3>
<p>If the command is not configured correctly, you’ll see exceptions on startup like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>intelmq_manager.runctl.IntelMQCtlError:<span class="w"> </span>&lt;ERROR_MESSAGE&gt;
</pre></div>
</div>
<p>This means the intelmqctl command could not be executed as a subprocess.
The <code class="docutils literal notranslate"><span class="pre">&lt;ERROR_MESSAGE&gt;</span></code> should indicate why.</p>
</section>
<section id="access-denied-authentication-required-please-provide-valid-token-verification-credentials">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Access Denied / Authentication Required “Please provide valid Token verification credentials”</a><a class="headerlink" href="#access-denied-authentication-required-please-provide-valid-token-verification-credentials" title="Permalink to this heading">¶</a></h3>
<p>If you see the IntelMQ Manager interface and menu, but the API calls to the back-end querying configuration and status of IntelMQ fail with “Access Denied” or “Authentication Required: Please provide valid Token verification credentials” errors, you are maybe not logged in while the API requires authentication.</p>
<p>By default, the API requires authentication. Create user accounts and login with them, or - if you have other protection means in place - deactivate the authentication requirement by removing or renaming the <cite>session_store</cite> parameter in the configuration.</p>
</section>
<section id="internal-server-error">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Internal Server Error</a><a class="headerlink" href="#internal-server-error" title="Permalink to this heading">¶</a></h3>
<p>There can be various reasons for internal server errors. You need to look at the error log of your web server, for example <code class="docutils literal notranslate"><span class="pre">/var/log/apache2/error.log</span></code> or <code class="docutils literal notranslate"><span class="pre">/var/log/httpd/error_log</span></code> for Apache 2. It could be that the sudo-setup is not functional, the configuration file or session database file can not be read or written or other errors in regard to the execution of the API program.</p>
</section>
<section id="can-i-just-install-it-from-the-deb-rpm-packages-while-installing-intelmq-from-a-different-source">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Can I just install it from the deb/rpm packages while installing IntelMQ from a different source?</a><a class="headerlink" href="#can-i-just-install-it-from-the-deb-rpm-packages-while-installing-intelmq-from-a-different-source" title="Permalink to this heading">¶</a></h3>
<p>Yes, you can install the API and the Manager from the deb/rpm repositories, and install your IntelMQ from a somewhere else, e.g. a local repository.
However, knowledge about Python and system administration experience is recommended if you do so.</p>
<p>The packages install IntelMQ to <code class="docutils literal notranslate"><span class="pre">/usr/lib/python3*/site-packages/intelmq/</span></code>.
Installing with <code class="docutils literal notranslate"><span class="pre">pip</span></code> results in <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/python3*/site-packages/intelmq/</span></code> (and some other accompanying resources) which overrides the installation in <code class="docutils literal notranslate"><span class="pre">/usr/lib/</span></code>.
You probably need to adapt the configuration parameter <code class="docutils literal notranslate"><span class="pre">intelmq_ctl_cmd</span></code> to the <code class="docutils literal notranslate"><span class="pre">/usr/local/bin/intelmqctl</span></code> executable and some other tweaks.</p>
</section>
<section id="sqlite3-operationalerror-attempt-to-write-a-readonly-database">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">sqlite3.OperationalError: attempt to write a readonly database</a><a class="headerlink" href="#sqlite3-operationalerror-attempt-to-write-a-readonly-database" title="Permalink to this heading">¶</a></h3>
<p>SQLite does not only need write access to the database itself, but also the folder the database file is located in. Please check that the webserver has <cite>write</cite> permissions to the folder
the session file is located in.</p>
</section>
<section id="sqlite3-operationalerror-unable-to-open-database-file">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">sqlite3.OperationalError: unable to open database file</a><a class="headerlink" href="#sqlite3-operationalerror-unable-to-open-database-file" title="Permalink to this heading">¶</a></h3>
<p>Please check the <code class="docutils literal notranslate"><span class="pre">session_store</span></code> in <code class="docutils literal notranslate"><span class="pre">api-config.json</span></code> and ensure the path is correct - the
directory exists and application can write to it.</p>
</section>
<section id="gunicorn-returns-modulenotfounderror-no-module-named-uvicorn-but-uvicorn-is-installed">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Gunicorn returns <code class="docutils literal notranslate"><span class="pre">ModuleNotFoundError:</span> <span class="pre">No</span> <span class="pre">module</span> <span class="pre">named</span> <span class="pre">'uvicorn'</span></code>, but Uvicorn is installed</a><a class="headerlink" href="#gunicorn-returns-modulenotfounderror-no-module-named-uvicorn-but-uvicorn-is-installed" title="Permalink to this heading">¶</a></h3>
<p>Most probably one of them (Gunicorn and Uvicorn) were installed using different method (e.g. one
from native system package, other from pip). Try to install both from one source. You may need
to eventually update the Gunicorn executable path in <cite>intelmq-api.service</cite>.</p>
</section>
<section id="can-i-use-other-web-servers-or-proxy">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Can I use other web servers or proxy?</a><a class="headerlink" href="#can-i-use-other-web-servers-or-proxy" title="Permalink to this heading">¶</a></h3>
<p>Yes, the proposed setup with Gunicorn and Apache 2 is just one of many possibilities. You can
refer to the <a class="reference external" href="https://fastapi.tiangolo.com/deployment/">FastAPI documentation</a> for another
examples.</p>
</section>
<section id="how-to-debug-api-running-as-system-service">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">How to debug API running as system service?</a><a class="headerlink" href="#how-to-debug-api-running-as-system-service" title="Permalink to this heading">¶</a></h3>
<p>If you experience any issues with the API, please first check the logs provided in journal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>journalctl<span class="w"> </span>-u<span class="w"> </span>intelmq-api
</pre></div>
</div>
</section>
</section>
<section id="getting-help">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Getting help</a><a class="headerlink" href="#getting-help" title="Permalink to this heading">¶</a></h2>
<p>You can use the <a class="reference external" href="https://lists.cert.at/cgi-bin/mailman/listinfo/intelmq-users">IntelMQ users mailing lists</a> and <a class="reference external" href="https://github.com/certtools/intelmq-api/issues/new">GitHub issues</a> for getting help and getting in touch with other users and developers. See also the <a class="reference internal" href="introduction.html"><span class="doc">Introduction</span></a> page.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/Logo_Intel_MQ.svg" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">IntelMQ is a solution for IT security teams for collecting and processing security feeds using a message queuing protocol.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=certtools&repo=intelmq&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="organization.html">IntelMQ Organizational Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Getting support</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html#development">Development</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hardware-requirements.html">Hardware Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration-management.html">Configuration and Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="bots.html">Bots inventory</a></li>
<li class="toctree-l1"><a class="reference internal" href="intelmqctl.html">intelmqctl documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="feeds.html">Data Feeds</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">IntelMQ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="intelmq-manager.html">IntelMQ Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently asked questions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="universe.html">IntelMQ Universe</a></li>
<li class="toctree-l1"><a class="reference internal" href="ELK-Stack.html">ELK Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="MISP-Integrations.html">MISP integrations in IntelMQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="n6-integrations.html">IntelMQ - n6 Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="CIFv3-Integrations.html">CIFv3 integrations in IntelMQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="eventdb.html">EventDB</a></li>
<li class="toctree-l1"><a class="reference internal" href="abuse-contacts.html">Abuse-contact look-ups</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/guide.html">Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/library.html">Running IntelMQ as Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/data-format.html">Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/harmonization-fields.html">Harmonization field names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/release-procedure.html">Release procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/feeds-wishlist.html">Feeds wishlist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/modules.html">Code documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="feeds.html" title="previous chapter">Data Feeds</a></li>
      <li>Next: <a href="intelmq-manager.html" title="next chapter">IntelMQ Manager</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, IntelMQ community.
      
      |
      <a href="../_sources/user/intelmq-api.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>