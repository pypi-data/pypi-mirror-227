(self.webpackChunkjupyterlab_remote_contents=self.webpackChunkjupyterlab_remote_contents||[]).push([[809],{809:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w});var r=n(303),s=n(122),o=n(720),i=n(745),a=n(344),c=n(155);let l;var u,h;l="undefined"==typeof window?n(26):WebSocket,function(e){e.makeSettings=function(e){return h.makeSettings(e)},e.makeRequest=function(e,t,n,r){const s={...n.queryParams,...r},o=e+a.URLExt.objectToQueryString(s);return h.handleRequest(o,t,n)};class t extends Error{constructor(e,n=t._defaultMessage(e),r=""){super(n),this.response=e,this.traceback=r}static async create(e){try{const n=await e.json(),{message:r,traceback:s}=n;return s&&console.error(s),new t(e,r??t._defaultMessage(e),s??"")}catch(n){return console.debug(n),new t(e)}}static _defaultMessage(e){return`Invalid response: ${e.status} ${e.statusText}`}}e.ResponseError=t;class n extends TypeError{constructor(e){super(e.message),this.stack=e.stack}}e.NetworkError=n}(u||(u={})),function(e){e.makeSettings=function(e={}){const t=a.PageConfig.getBaseUrl(),n=a.PageConfig.getWsUrl(),r=e.baseUrl||"",s=e.queryParams||{};let o=e.wsUrl;return o||r!==t||(o=n),o||0!==r.indexOf("http")||(o="ws"+r.slice(4)),o=o??n,{init:{cache:"no-store",credentials:"same-origin"},fetch,Headers,Request,WebSocket:l,token:a.PageConfig.getToken(),appUrl:a.PageConfig.getOption("appUrl"),appendToken:"undefined"==typeof window||void 0!==c&&void 0!==c?.env?.JEST_WORKER_ID||a.URLExt.getHostName(t)!==a.URLExt.getHostName(o),...e,baseUrl:r,queryParams:s,wsUrl:o}},e.handleRequest=function(e,t,n){if(0!==e.indexOf(n.baseUrl))throw new Error("Can only be used for notebook server requests");"no-store"===(t.cache??n.init.cache)&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());const r=new n.Request(e,{...n.init,...t});let s=!1;if(n.token&&(s=!0,r.headers.append("Authorization",`token ${n.token}`)),"undefined"!=typeof document&&document?.cookie){const e=("_xsrf",document.cookie.match("\\b_xsrf=([^;]*)\\b")?.[1]);void 0!==e&&(s=!0,r.headers.append("X-XSRFToken",e))}return!r.headers.has("Content-Type")&&s&&r.headers.set("Content-Type","application/json"),n.fetch.call(null,r).catch((e=>{throw new u.NetworkError(e)}))}}(h||(h={}));var d,f=n(840);class p{constructor(e={}){this._isDisposed=!1,this._fileChanged=new f.Signal(this),this.name=e.name??"Default",this._apiEndpoint=e.apiEndpoint??"api/contents",this.serverSettings=e.serverSettings??u.makeSettings()}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,f.Signal.clearData(this))}async get(e,t){let n=this._getUrl(e),r={};if(t){"notebook"===t.type&&delete t.format;const e=t.content?"1":"0";r={...t,content:e}}const s=this.serverSettings,o=await u.makeRequest(n,{},s,r);if(200!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),i}getDownloadUrl(e){const t=this.serverSettings.baseUrl;let n=a.URLExt.join(t,"files",a.URLExt.encodeParts(e));const r=document.cookie.match("\\b_xsrf=([^;]*)\\b");if(r){const e=new URL(n);e.searchParams.append("_xsrf",r[1]),n=e.toString()}return Promise.resolve(n)}async newUntitled(e={}){let t="{}";e&&(e.ext&&(e.ext=d.normalizeExtension(e.ext)),t=JSON.stringify(e));const n=this.serverSettings,r=this._getUrl(e.path??""),s={method:"POST",body:t},o=await u.makeRequest(r,s,n);if(201!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),this._fileChanged.emit({type:"new",oldValue:null,newValue:i}),i}async delete(e){const t=this._getUrl(e),n=this.serverSettings,r=await u.makeRequest(t,{method:"DELETE"},n);if(204!==r.status)throw await u.ResponseError.create(r);this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async rename(e,t){const n=this.serverSettings,r=this._getUrl(e),s={method:"PATCH",body:JSON.stringify({path:t})},o=await u.makeRequest(r,s,n);if(200!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:i}),i}async save(e,t={}){const n=this.serverSettings,r=this._getUrl(e),s={method:"PUT",body:JSON.stringify(t)},o=await u.makeRequest(r,s,n);if(200!==o.status&&201!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),this._fileChanged.emit({type:"save",oldValue:null,newValue:i}),i}async copy(e,t){const n=this.serverSettings,r=this._getUrl(t),s={method:"POST",body:JSON.stringify({copy_from:e})},o=await u.makeRequest(r,s,n);if(201!==o.status)throw await u.ResponseError.create(o);const i=await o.json();return d.validateContentsModel(i),this._fileChanged.emit({type:"new",oldValue:null,newValue:i}),i}async createCheckpoint(e){const t=this._getUrl(e,"checkpoints"),n=await u.makeRequest(t,{method:"POST"},this.serverSettings);if(201!==n.status)throw await u.ResponseError.create(n);const r=await n.json();return d.validateCheckpointModel(r),r}async listCheckpoints(e){const t=this._getUrl(e,"checkpoints"),n=await u.makeRequest(t,{},this.serverSettings);if(200!==n.status)throw await u.ResponseError.create(n);const r=await n.json();if(!Array.isArray(r))throw new Error("Invalid Checkpoint list");for(let e=0;e<r.length;e++)d.validateCheckpointModel(r[e]);return r}async restoreCheckpoint(e,t){const n=this._getUrl(e,"checkpoints",t),r=await u.makeRequest(n,{method:"POST"},this.serverSettings);if(204!==r.status)throw await u.ResponseError.create(r)}async deleteCheckpoint(e,t){const n=this._getUrl(e,"checkpoints",t),r=await u.makeRequest(n,{method:"DELETE"},this.serverSettings);if(204!==r.status)throw await u.ResponseError.create(r)}_getUrl(...e){const t=e.map((e=>a.URLExt.encodeParts(e))),n=this.serverSettings.baseUrl;if(!n)throw new Error("Jupyter server URL not set");return a.URLExt.join(n,this._apiEndpoint,...t)}}!function(e){function t(e,t,n,r=[]){if(!e.hasOwnProperty(t))throw Error(`Missing property '${t}'`);const s=e[t];if(void 0!==n){let e=!0;switch(n){case"array":e=Array.isArray(s);break;case"object":e=void 0!==s;break;default:e=typeof s===n}if(!e)throw new Error(`Property '${t}' is not of type '${n}'`);if(r.length>0){let e=!0;switch(n){case"string":case"number":case"boolean":e=r.includes(s);break;default:e=r.findIndex((e=>e===s))>=0}if(!e)throw new Error(`Property '${t}' is not one of the valid values ${JSON.stringify(r)}`)}}}e.normalizeExtension=function(e){return e.length>0&&0!==e.indexOf(".")&&(e=`.${e}`),e},e.validateProperty=t,e.validateContentsModel=function(e){t(e,"name","string"),t(e,"path","string"),t(e,"type","string"),t(e,"created","string"),t(e,"last_modified","string"),t(e,"mimetype","object"),t(e,"content","object"),t(e,"format","object")},e.validateCheckpointModel=function(e){t(e,"id","string"),t(e,"last_modified","string")}}(d||(d={}));const w={id:"jupyterlab-remote-contents:plugin",requires:[s.IFileBrowserFactory,o.ITranslator],autoStart:!0,activate:(e,t,n)=>{const{serviceManager:s}=e,{createFileBrowser:o}=t,a=n.load("jupyterlab-remote-contents"),c=u.makeSettings(),l=new p({serverSettings:c,name:"Remote"});s.contents.addDrive(l);const h=o("jp-remote-contents-browser",{driveName:l.name,restore:!1});h.title.caption=a.__("Remote Contents (not connected)"),h.title.icon=i.listIcon;const d=new r.ToolbarButton({icon:i.folderIcon,onClick:async()=>{let e=prompt("Please enter the Jupyter server URL:","http://127.0.0.1:8000");if(e){const t=new URL(e),n=t.search,r=Object.fromEntries(t.searchParams);n&&(e=e.slice(0,-n.length)),l.serverSettings.baseUrl=e,l.serverSettings.queryParams=r,h.title.caption=a.__(`Remote Contents at ${e}`),h.model.cd("/")}},tooltip:a.__("Connect to Jupyter Server")});h.toolbar.insertItem(0,"connect-to-server",d),e.shell.add(h,"left")}}},155:e=>{var t,n,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var a,c=[],l=!1,u=-1;function h(){l&&a&&(l=!1,a.length?c=a.concat(c):u=-1,c.length&&d())}function d(){if(!l){var e=i(h);l=!0;for(var t=c.length;t;){for(a=c,c=[];++u<t;)a&&a[u].run();u=-1,t=c.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||l||i(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},26:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}}]);